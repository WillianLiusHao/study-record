(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{199:function(s,t,a){"use strict";a.r(t);var e=a(6),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"vite"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite"}},[s._v("#")]),s._v(" vite")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// vite 1.0 => vite 2.0  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("本地服务器：koa")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" http "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" connect   \n预优化：rollup "),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("插件")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" esbuild\n")])])]),t("h3",{attrs:{id:"工程化的痛点和解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工程化的痛点和解决方案"}},[s._v("#")]),s._v(" 工程化的痛点和解决方案")]),s._v(" "),t("ul",[t("li",[s._v("模块化需求\n"),t("ul",[t("li",[s._v("提供模块加载方案")]),s._v(" "),t("li",[s._v("兼容不同模块规范")])])]),s._v(" "),t("li",[s._v("语法转译\n"),t("ul",[t("li",[s._v("高级语法转译 sass、ts")]),s._v(" "),t("li",[s._v("资源加载，图片/字体等")])])]),s._v(" "),t("li",[s._v("产物质量\n"),t("ul",[t("li",[s._v("产物压缩、代码混淆、tree shaking、语法降级")])])]),s._v(" "),t("li",[s._v("开发效率\n"),t("ul",[t("li",[s._v("HRM、构建提速")])])])]),s._v(" "),t("h3",{attrs:{id:"功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[s._v("#")]),s._v(" 功能")]),s._v(" "),t("ul",[t("li",[s._v("预构建 和 依赖解析\n"),t("ul",[t("li",[s._v("预构建：依赖统一转为 ESM 模式，由 "),t("code",[s._v("esbuild")]),s._v(" 完成")]),s._v(" "),t("li",[s._v("依赖解析：重写 url")])])]),s._v(" "),t("li",[s._v("模块热替换")]),s._v(" "),t("li",[s._v("TS 支持\n"),t("ul",[t("li",[s._v("天然支持 "),t("code",[s._v(".ts")]),s._v("文件，内部会进行 ts 的转译工作")])])])]),s._v(" "),t("h3",{attrs:{id:"架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[s._v("#")]),s._v(" 架构")]),s._v(" "),t("blockquote",[t("p",[s._v("性能利器：Esbuild")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("依赖于构建 - bundle 工具")]),s._v(" "),t("ul",[t("li",[s._v("优点\n"),t("ul",[t("li",[s._v("快，极致的快！")])])]),s._v(" "),t("li",[s._v("缺点\n"),t("ul",[t("li",[s._v("不支持 "),t("code",[s._v("ES5")]),s._v(", 低版本浏览器无法运行")]),s._v(" "),t("li",[s._v("不提供操作打包产物的接口")]),s._v(" "),t("li",[s._v("不支持自定义的 "),t("code",[s._v("code splitting")]),s._v("，降低拆包优化的灵活了")])])])])]),s._v(" "),t("li",[t("p",[s._v("单文件编译 - ts 和 jsx 的编译工具")])]),s._v(" "),t("li",[t("p",[s._v("代码压缩 - 压缩工具")])])]),s._v(" "),t("h3",{attrs:{id:"核心原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#核心原理"}},[s._v("#")]),s._v(" 核心原理")]),s._v(" "),t("ol",[t("li",[s._v("模块声明")])]),s._v(" "),t("p",[s._v("在 index.html 入口处将 main.js 的 script 标签加入 "),t("code",[s._v('type="module"')]),s._v("属性，声明是一个模块")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"module"')]),s._v(" src"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main.js"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("p",[s._v("这样通过src或import导入的文件将会发起http请求；")]),s._v(" "),t("p",[s._v("vite 服务器会拦截这些请求，并将请求文件进行特别处理。")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("裸模块替换")])]),s._v(" "),t("p",[s._v("将裸模块替换成 node_modules 下的模块")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Vue "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v(" 会转换成 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Vue "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/@modules/vue'")]),s._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("解析/@modules")])]),s._v(" "),t("p",[s._v("接下里将/@modules解析为真正的文件地址，并返回给浏览器。")]),s._v(" "),t("p",[s._v("通过 import 导入的文件 webpack 会去 node_modules/包名/package.json 文件内找 module 属性,得到真正的原始模块地址。")]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[s._v("解析单文件（SFC）组件")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("template "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("@vue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("compiler"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dom\nscript "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("@vue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("compiler"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sfc\nstyle "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" updateStyle\n")])])]),t("h3",{attrs:{id:"具体功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#具体功能"}},[s._v("#")]),s._v(" 具体功能")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("模块解析")])])]),s._v(" "),t("p",[s._v("利用 "),t("code",[s._v("es-module-lexer")]),s._v(" 进行词法分析，可快速得出 "),t("code",[s._v("import")]),s._v(" 和 "),t("code",[s._v("export")]),s._v(" 语句")]),s._v(" "),t("ul",[t("li",[s._v("裸模块导入 "),t("code",[s._v("vue => /@modules/vue.js")])]),s._v(" "),t("li",[s._v("相对路径转绝对路径\n"),t("ul",[t("li",[s._v("js")]),s._v(" "),t("li",[s._v("css")])])]),s._v(" "),t("li",[s._v("加时间戳，防止浏览器缓存")])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("预构建")])])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("why?")]),s._v(" "),t("ul",[t("li",[s._v("因为依赖了浏览器的 es 模块解析功能，所以必须保证所有的依赖都是 esm 规范的（但仍有许多是 cjs 的第三方模块）")]),s._v(" "),t("li",[s._v("esm 请求会造成瀑布流")])])]),s._v(" "),t("li",[t("p",[s._v("how?")]),s._v(" "),t("ul",[t("li",[s._v("将其他格式(如 UMD 和 CommonJS)的产物转换为 ESM 格式，使其在浏览器通过 "),t("script",{attrs:{type:"module"}})])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);