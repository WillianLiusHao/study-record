# TCP & UDP
## UDP

|   tcp   |   udp   |
|   ---   |   ---   |
| 传输层   | 传输层  |
| 面向连接 | 无连接  |
| 安全可靠 | 不可靠  |
| 延迟高，传输较慢 | 延迟低 |
| 大文件 | 小文件 |

## TCP

### 特点

- 面向连接的传输层协议
- 可靠
- 基于字节流
- 超时重传
- 拥塞控制

`面向连接` 指的的是 TCP 需要 `三次握手`

`可靠性` 指 TCP 具有 `确认应答ACK` 和 `序列号` 来实现可靠传输

`基于字节流` 指的是 `UDP`的传输是将一个完整的用户消息发送一个`UDP`报文；而`TCP`是将一条用户消息根据滑动窗口的字节大小，拆分成多个`TCP`报文段（`TCP将数据看作一连串字节流`）

### 端口号


### 三次握手

- 目的：**建立可靠的通信通道**，确认双方的发送和接收能力

- 过程：

  - 男：喂，听得到吗？  
  - 女：听得到，你听得到吗？  
  - 男：我也听得到  
  --> 建立连接

- 图解
  - `seq` 和 `ack` 都是32位的序号  
  - `SYN`/`ACK`/`FIN` 标志位，都只占1位（0或1）

![](../../../assets/3timeshandshakes.svg)

![](../../../assets/3timeshandshake.png)

- 回答细节
  - ack确认号 = seq序号 + 1
  - SYN,ACK 标志位都是1位
  - 发送完 SYN 和接收到 ACK 后各自的状态（`SYN-SEND`、`SYN-RCVD`、`ESTABLISHED`）

### 四次挥手

- 过程

  - 男：我没什么要说的了，你还有的话你继续说  
  - 女：我知道了  
  男方继续听女方balabala  
  - 女：我说完了  
  - 男：我知道了  
  --> 电话挂断

- 图解

![](../../../assets/4timeshandbaibai.svg)

![](../../../assets/4timeshandbaibai.png)

- 思考

**为什么服务端第二次和第三次挥手要分开？**


**第四次挥手，为什么客户端在 TIME-WAIT 状态必须等待 2MSL（即两倍的最大报文段生存时间） 的时间呢?**

因为在最后客户端发送完 ACK 报文后，可能存在服务端没有收到的情况，此时服务端会重发 FIN 报文
