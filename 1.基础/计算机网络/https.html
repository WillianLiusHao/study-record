<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTPS | 前端随笔 WillianLiusHao</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="勤学如春起之苗，不见其增，日有所长">
    
    <link rel="preload" href="/study-record/assets/css/0.styles.ee9d39b9.css" as="style"><link rel="preload" href="/study-record/assets/js/app.17aac99d.js" as="script"><link rel="preload" href="/study-record/assets/js/2.016b014c.js" as="script"><link rel="preload" href="/study-record/assets/js/1.4d9187d3.js" as="script"><link rel="preload" href="/study-record/assets/js/11.fa712348.js" as="script"><link rel="prefetch" href="/study-record/assets/js/10.36503388.js"><link rel="prefetch" href="/study-record/assets/js/12.276efbb7.js"><link rel="prefetch" href="/study-record/assets/js/13.d963e8a7.js"><link rel="prefetch" href="/study-record/assets/js/14.d7577f19.js"><link rel="prefetch" href="/study-record/assets/js/15.cc1f798a.js"><link rel="prefetch" href="/study-record/assets/js/16.0291a868.js"><link rel="prefetch" href="/study-record/assets/js/17.0a30da7e.js"><link rel="prefetch" href="/study-record/assets/js/18.0cfbb48c.js"><link rel="prefetch" href="/study-record/assets/js/19.0e21e7df.js"><link rel="prefetch" href="/study-record/assets/js/20.03daea74.js"><link rel="prefetch" href="/study-record/assets/js/21.3b8bed13.js"><link rel="prefetch" href="/study-record/assets/js/22.044c0ee0.js"><link rel="prefetch" href="/study-record/assets/js/23.2e58d861.js"><link rel="prefetch" href="/study-record/assets/js/24.5d91c0ed.js"><link rel="prefetch" href="/study-record/assets/js/25.ecbc19e1.js"><link rel="prefetch" href="/study-record/assets/js/26.ea32b772.js"><link rel="prefetch" href="/study-record/assets/js/27.7994195c.js"><link rel="prefetch" href="/study-record/assets/js/28.1d2d8781.js"><link rel="prefetch" href="/study-record/assets/js/29.29644b5e.js"><link rel="prefetch" href="/study-record/assets/js/3.babd7043.js"><link rel="prefetch" href="/study-record/assets/js/30.c1b69b54.js"><link rel="prefetch" href="/study-record/assets/js/31.b8531d02.js"><link rel="prefetch" href="/study-record/assets/js/32.1a3d2119.js"><link rel="prefetch" href="/study-record/assets/js/33.4073fb14.js"><link rel="prefetch" href="/study-record/assets/js/34.5873267c.js"><link rel="prefetch" href="/study-record/assets/js/35.22f30e0a.js"><link rel="prefetch" href="/study-record/assets/js/36.9acadcf0.js"><link rel="prefetch" href="/study-record/assets/js/37.514fb866.js"><link rel="prefetch" href="/study-record/assets/js/38.cfd8eaf8.js"><link rel="prefetch" href="/study-record/assets/js/39.b18930b7.js"><link rel="prefetch" href="/study-record/assets/js/4.fa802c58.js"><link rel="prefetch" href="/study-record/assets/js/40.ce709979.js"><link rel="prefetch" href="/study-record/assets/js/41.2042214a.js"><link rel="prefetch" href="/study-record/assets/js/42.87b852a8.js"><link rel="prefetch" href="/study-record/assets/js/43.b4287906.js"><link rel="prefetch" href="/study-record/assets/js/44.6bf10f9a.js"><link rel="prefetch" href="/study-record/assets/js/45.25eeefa0.js"><link rel="prefetch" href="/study-record/assets/js/46.0f8cb01f.js"><link rel="prefetch" href="/study-record/assets/js/47.288a54bb.js"><link rel="prefetch" href="/study-record/assets/js/48.b613c839.js"><link rel="prefetch" href="/study-record/assets/js/49.d18be6a8.js"><link rel="prefetch" href="/study-record/assets/js/5.87700c1c.js"><link rel="prefetch" href="/study-record/assets/js/50.400520f0.js"><link rel="prefetch" href="/study-record/assets/js/51.7eab7fad.js"><link rel="prefetch" href="/study-record/assets/js/52.caaed993.js"><link rel="prefetch" href="/study-record/assets/js/53.55fabd90.js"><link rel="prefetch" href="/study-record/assets/js/54.1a826e47.js"><link rel="prefetch" href="/study-record/assets/js/55.e0c40590.js"><link rel="prefetch" href="/study-record/assets/js/56.42f5fc5f.js"><link rel="prefetch" href="/study-record/assets/js/57.8f30f2af.js"><link rel="prefetch" href="/study-record/assets/js/58.63b92872.js"><link rel="prefetch" href="/study-record/assets/js/59.bd09ccb3.js"><link rel="prefetch" href="/study-record/assets/js/6.9086b17c.js"><link rel="prefetch" href="/study-record/assets/js/60.e7406693.js"><link rel="prefetch" href="/study-record/assets/js/61.f2e5a88e.js"><link rel="prefetch" href="/study-record/assets/js/62.0b65291e.js"><link rel="prefetch" href="/study-record/assets/js/63.8de3fdca.js"><link rel="prefetch" href="/study-record/assets/js/64.4e11deef.js"><link rel="prefetch" href="/study-record/assets/js/65.54d039db.js"><link rel="prefetch" href="/study-record/assets/js/66.84db7a63.js"><link rel="prefetch" href="/study-record/assets/js/67.1c39ed43.js"><link rel="prefetch" href="/study-record/assets/js/68.c06e0761.js"><link rel="prefetch" href="/study-record/assets/js/69.ab2a8f77.js"><link rel="prefetch" href="/study-record/assets/js/7.8ac123f2.js"><link rel="prefetch" href="/study-record/assets/js/70.4ac2a1eb.js"><link rel="prefetch" href="/study-record/assets/js/71.a10a64a1.js"><link rel="prefetch" href="/study-record/assets/js/72.f5ee9344.js"><link rel="prefetch" href="/study-record/assets/js/73.ce032dd2.js"><link rel="prefetch" href="/study-record/assets/js/74.0867294f.js"><link rel="prefetch" href="/study-record/assets/js/75.a2ebcace.js"><link rel="prefetch" href="/study-record/assets/js/76.c3eb5991.js"><link rel="prefetch" href="/study-record/assets/js/77.06a7f50c.js"><link rel="prefetch" href="/study-record/assets/js/78.5fb20fe2.js"><link rel="prefetch" href="/study-record/assets/js/79.f6266092.js"><link rel="prefetch" href="/study-record/assets/js/80.d3237485.js"><link rel="prefetch" href="/study-record/assets/js/81.59c4725f.js"><link rel="prefetch" href="/study-record/assets/js/82.d198b1a8.js"><link rel="prefetch" href="/study-record/assets/js/83.88fb1a26.js"><link rel="prefetch" href="/study-record/assets/js/84.43f20fa1.js"><link rel="prefetch" href="/study-record/assets/js/85.2ea9262b.js"><link rel="prefetch" href="/study-record/assets/js/86.d3f5931d.js"><link rel="prefetch" href="/study-record/assets/js/87.b1833438.js"><link rel="prefetch" href="/study-record/assets/js/88.4359c8a8.js"><link rel="prefetch" href="/study-record/assets/js/89.2c40610e.js"><link rel="prefetch" href="/study-record/assets/js/90.5546c4ab.js"><link rel="prefetch" href="/study-record/assets/js/91.22180d3b.js"><link rel="prefetch" href="/study-record/assets/js/92.15962496.js"><link rel="prefetch" href="/study-record/assets/js/vendors~docsearch.32379f2b.js">
    <link rel="stylesheet" href="/study-record/assets/css/0.styles.ee9d39b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-record/" class="home-link router-link-active"><!----> <span class="site-name">前端随笔 WillianLiusHao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/WillianLiusHao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/WillianLiusHao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>1.基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>html&amp;css&amp;js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/study-record/1.基础/大纲.html" class="sidebar-link">大纲</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>手写</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>计算机网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-record/1.基础/计算机网络/cookie.html" class="sidebar-link">cookie</a></li><li><a href="/study-record/1.基础/计算机网络/DNS.html" class="sidebar-link">DNS</a></li><li><a href="/study-record/1.基础/计算机网络/http.html" class="sidebar-link">http</a></li><li><a href="/study-record/1.基础/计算机网络/https.html" class="active sidebar-link">https</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_1-https-是什么" class="sidebar-link">1. HTTPS 是什么</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_1-1-概念" class="sidebar-link">1.1 概念</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_1-2-ssl-tls-王老吉和加多宝" class="sidebar-link">1.2 SSL / TLS （王老吉和加多宝）</a></li></ul></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-加密" class="sidebar-link">2 加密</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-1-对称加密-aes" class="sidebar-link">2.1 对称加密 AES</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-2-非对称加密-rsa" class="sidebar-link">2.2 非对称加密 RSA</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-3-哈希-md5-sha256" class="sidebar-link">2.3 哈希 MD5/SHA256</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-4-数字签名-sha256-rsa" class="sidebar-link">2.4 数字签名 SHA256 RSA</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-5-数字证书" class="sidebar-link">2.5 数字证书</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-6-算法" class="sidebar-link">2.6 算法</a></li></ul></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_3-密钥协商" class="sidebar-link">3. 密钥协商</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#常见秘钥交换算法" class="sidebar-link">常见秘钥交换算法</a></li></ul></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_4-tls-握手过程" class="sidebar-link">4. TLS 握手过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#tls-rsa-握手-反复阅读熟记" class="sidebar-link">TLS-RSA 握手(反复阅读熟记)</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#tls-ecdhe-握手" class="sidebar-link">TLS-ECDHE 握手</a></li></ul></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_5-tls-握手过程详解" class="sidebar-link">5. TLS 握手过程详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_1-第一次握手-【client-hello】" class="sidebar-link">1. 第一次握手 【Client Hello】</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_2-第二次握手-【server-hello-server-certificate-server-hello-done】" class="sidebar-link">2. 第二次握手 【Server Hello + Server Certificate + Server Hello Done】</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_3-第三次握手" class="sidebar-link">3. 第三次握手</a></li><li class="sidebar-sub-header"><a href="/study-record/1.基础/计算机网络/https.html#_4-第四次握手" class="sidebar-link">4. 第四次握手</a></li></ul></li></ul></li><li><a href="/study-record/1.基础/计算机网络/question.html" class="sidebar-link">question</a></li><li><a href="/study-record/1.基础/计算机网络/tcp&amp;udp.html" class="sidebar-link">tcp&amp;udp</a></li><li><a href="/study-record/1.基础/计算机网络/浏览器跨域.html" class="sidebar-link">浏览器跨域</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2.项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3.算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4.日常</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5.脑图</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/study-record/" aria-current="page" class="sidebar-link">index</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h1> <h2 id="_1-https-是什么"><a href="#_1-https-是什么" class="header-anchor">#</a> 1. HTTPS 是什么</h2> <h3 id="_1-1-概念"><a href="#_1-1-概念" class="header-anchor">#</a> 1.1 概念</h3> <p>HTTPS 是在 HTTP 的基础上，利用 <code>SSL/TLS</code> 加密数据包。</p> <p>HTTP 的风险和对策</p> <table><thead><tr><th>风险</th> <th>对策</th> <th>方法</th></tr></thead> <tbody><tr><td>信息窃听</td> <td>信息加密</td> <td>对称加密 AES</td></tr> <tr><td>密钥传递</td> <td>密钥协商</td> <td>非对称加密 (RSA和ECC)</td></tr> <tr><td>信息篡改</td> <td>完整性校验</td> <td>散列算法（md5和SHA）</td></tr> <tr><td>身份冒充</td> <td>CA权威认证</td> <td>散列算法（md5和SHA）+ RSA 签名</td></tr></tbody></table> <h3 id="_1-2-ssl-tls-王老吉和加多宝"><a href="#_1-2-ssl-tls-王老吉和加多宝" class="header-anchor">#</a> 1.2 SSL / TLS （王老吉和加多宝）</h3> <div class="language-js extra-class"><pre class="language-js"><code>https     <span class="token operator">=</span>  http  <span class="token operator">+</span>  <span class="token constant">TLS</span><span class="token operator">/</span><span class="token constant">SSL</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>     风险      目的
  http  <span class="token operator">|</span>   信息窃听  信息加密
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>    信息篡改  数据完整性
tls<span class="token operator">/</span>ssl <span class="token operator">|</span>   信息劫持  身份验证
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>     
  tcp   <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
</code></pre></div><h2 id="_2-加密"><a href="#_2-加密" class="header-anchor">#</a> 2 加密</h2> <p>SSL/TLS 三类算法作用</p> <ul><li>非对称加密：身份验证，秘钥协商</li> <li>对称加密：信息加密</li> <li>散列算法：完整校验</li></ul> <h3 id="_2-1-对称加密-aes"><a href="#_2-1-对称加密-aes" class="header-anchor">#</a> 2.1 对称加密 AES</h3> <p><strong>AES</strong></p> <ul><li>aes-128-ecb</li> <li>aes-128-cbc</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>
<span class="token comment">// key：密钥   iv：盐</span>
<span class="token keyword">function</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cipher <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createCipheric</span><span class="token punctuation">(</span><span class="token string">'aes-128-cbc'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>
  cipher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">final</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span> <span class="token comment">// 输出16进制字符串</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cipher <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createCipheric</span><span class="token punctuation">(</span><span class="token string">'aes-128-cbc'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>
  cipher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'hec'</span><span class="token punctuation">)</span> <span class="token comment">// 添加16进制数据</span>
  <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">final</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token comment">// 输出utf8字符串</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-非对称加密-rsa"><a href="#_2-2-非对称加密-rsa" class="header-anchor">#</a> 2.2 非对称加密 RSA</h3> <p><strong>公钥加密私钥解，私钥加密公钥解</strong></p> <ul><li><p>非对称加密的核心：<code>单向函数</code></p></li> <li><p><strong>RSA</strong>（原始数据m, 加密数据c）</p> <ul><li><p>公钥（e,N）已知，加密过程</p> <ul><li><code>m ^ e % N = c</code></li> <li>例子：5 ^ 7 % 33 = 14</li></ul></li> <li><p>私钥（d,N）解密过程</p> <ul><li><code>c ^ d % N = m</code></li> <li>例子：14 ^ 3 % 33 = 5</li></ul></li></ul></li></ul> <blockquote><p><strong>非对称的难点在于，如何通过公钥(e, N) 算出私钥 (d, N)</strong>，计算过程如下：</p></blockquote> <ol><li><strong>N</strong>：已知，且为 2个质数(p,q)的乘积，即 <code>p * q = N</code> (分解一个数成2个质数乘积是数学上的难题)</li> <li><strong>欧拉积 FN</strong>：<code>FN = (p-1)*(q-1)</code></li> <li>最后通过如下公式找到密钥的关键 <strong>d</strong>：<code>e * d % FN == 1</code></li></ol> <h3 id="_2-3-哈希-md5-sha256"><a href="#_2-3-哈希-md5-sha256" class="header-anchor">#</a> 2.3 哈希 MD5/SHA256</h3> <p>特点</p> <ol><li>不同输入有不同输出</li> <li>单向</li> <li>长度固定</li></ol> <table><thead><tr><th>hash类型</th> <th>md5</th> <th>sha256</th></tr></thead> <tbody><tr><td>长度</td> <td>32</td> <td>64</td></tr> <tr><td>加盐</td> <td>×</td> <td>√</td></tr></tbody></table> <h3 id="_2-4-数字签名-sha256-rsa"><a href="#_2-4-数字签名-sha256-rsa" class="header-anchor">#</a> 2.4 数字签名 SHA256 RSA</h3> <ul><li>作用：<strong>验证数据完整性 / 认证发送者身份</strong></li> <li>基本原理：<strong>私钥签名，公钥验证</strong></li> <li>具体流程
<ul><li>发送者用 <code>hash算法</code> 对要传递的信息进行摘要，生成 <code>数字指纹A</code></li> <li>发送者使用自己的 <code>私钥</code> 对数字指纹进行加密,形成 <code>数字签名</code></li> <li>发送者将 <code>消息</code>和<code>数字签名</code> 一同发送给接收者</li> <li>接收者使用发送者 <code>公钥</code> 进行解密，得到 <code>数字指纹A</code>（信息的hash值）</li> <li>接收者使用 <code>hash算法</code> 接收到的信息进行摘要，生成 <code>数字指纹B</code></li> <li>接收者比对 <code>A和B</code> ，如果一致，则验证了 <code>数据的完整性</code> 及 <code>发送者的真实性</code></li></ul></li> <li>实现</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> generateKeyPairSync<span class="token punctuation">,</span> createSign<span class="token punctuation">,</span> createVerify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 数字签名和验签
 */</span>
<span class="token comment">// 生成密钥对</span>
<span class="token keyword">const</span> rsa <span class="token operator">=</span> <span class="token function">generateKeyPairSync</span><span class="token punctuation">(</span><span class="token string">'rsa'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">modulusLength</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
  <span class="token literal-property property">publicKeyEncoding</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'spki'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'pem'</span> <span class="token comment">// base64 格式</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">privateKeyEncoding</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'pkcs8'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'pem'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cipher</span><span class="token operator">:</span> <span class="token string">'aes-256-cbc'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">passphrase</span><span class="token operator">:</span> <span class="token string">'passphrase'</span> <span class="token comment">// 私钥密码</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token string">'file'</span>
<span class="token comment">/* 文件签名*/</span>
<span class="token comment">// 创建签名实例</span>
<span class="token keyword">const</span> signObj <span class="token operator">=</span> <span class="token function">createSign</span><span class="token punctuation">(</span><span class="token string">'rsa-sha256'</span><span class="token punctuation">)</span>
<span class="token comment">// 放入文件内容</span>
signObj<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> 
<span class="token comment">// 私钥进行签名，输出16进制（hex ）字符串</span>
<span class="token keyword">let</span> sign <span class="token operator">=</span> signObj<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> rsa<span class="token punctuation">.</span>privateKey<span class="token punctuation">,</span> <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'pem'</span><span class="token punctuation">,</span> <span class="token literal-property property">passphrase</span><span class="token operator">:</span> <span class="token string">'passphrase'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span> 

<span class="token comment">/* 验签 */</span>
<span class="token keyword">const</span> verifyObj <span class="token operator">=</span> <span class="token function">createVerify</span><span class="token punctuation">(</span><span class="token string">'rsa-sha256'</span><span class="token punctuation">)</span>
verifyObj<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
<span class="token keyword">const</span> isValid <span class="token operator">=</span> verifyObj<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-5-数字证书"><a href="#_2-5-数字证书" class="header-anchor">#</a> 2.5 数字证书</h3> <ul><li>目的
<ul><li>认证 <strong>公钥持有者的身份</strong>,防止第三方冒充</li></ul></li> <li>内容
<ul><li>公钥</li> <li>持有者信息</li> <li>证书认证机构（CA）的信息</li> <li>证书有效期</li> <li>...</li></ul></li></ul> <p><strong>签发和验证流程</strong> <img src="/study-record/assets/img/cert.70b1beb7.png" alt=""></p> <ul><li><p><strong>CA 签发证书</strong>，如上图左边部分：</p> <ul><li><p>首先 CA 会把持有者的公钥、用途、颁发者、有效时间等信息打成一个包，然后对这些信息进行 Hash 计算，得到一个 Hash 值</p></li> <li><p>然后 CA 会使用自己的私钥将该 Hash 值加密，生成 <code>Certificate Signature</code>，也就是 CA 对证书做了签名</p></li> <li><p>最后将 Certificate Signature 添加在文件证书上，形成数字证书</p></li></ul></li> <li><p>客户端 <strong>校验服务端的数字证书</strong> 的过程，如上图右边部分</p> <ul><li><p>首先客户端会使用同样的 Hash 算法获取该证书的 Hash 值 H1</p></li> <li><p>通常浏览器和操作系统中集成了 CA 的公钥信息，浏览器收到证书后可以使用 CA 的公钥解密 Certificate Signature 内容，得到一个 Hash 值 H2</p></li> <li><p>最后比较 H1 和 H2，如果值相同，则为可信赖的证书，否则则认为证书不可信</p></li></ul></li></ul> <p><strong>全流程及具体字段</strong></p> <p><img src="/study-record/assets/img/cert2.ab900644.png" alt=""></p> <h3 id="_2-6-算法"><a href="#_2-6-算法" class="header-anchor">#</a> 2.6 算法</h3> <p><strong>Diffie-Hellman 算法(DH算法)</strong></p> <ul><li><p>特点：双方都不需要告知对方自己的秘钥情况下，协商一个公共的秘钥出来</p></li> <li><p>使用场景：协商密钥，计算对称加密的秘钥</p></li> <li><p>图解</p></li></ul> <p><img src="/study-record/assets/img/Diffie-Hellman_Key_Exchange.44a53bad.svg" alt=""></p> <ul><li>算法数学原理(<code>离散对数</code>)</li></ul> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">// 假设 p=2, a=3, b=4, N=10</span>
<span class="token comment">// a,b 是私钥，各自保存</span>
<span class="token comment">// 底数p，模N 是公开参数</span>
<span class="token keyword">let</span> p<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token constant">N</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">A</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">N</span> <span class="token comment">// 用 私钥a 生成 公钥A</span>
<span class="token keyword">let</span> <span class="token constant">B</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">N</span> <span class="token comment">// 用 私钥b 生成 公钥B</span>

<span class="token keyword">let</span> AcommonK <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token constant">B</span> <span class="token operator">^</span> a<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">N</span> <span class="token comment">// 公钥B和私钥a计算公共密钥 commonKey = 6</span>
<span class="token keyword">let</span> BcommonK <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token constant">A</span> <span class="token operator">^</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">N</span> <span class="token comment">// 公钥A和私钥b计算公共密钥 commonKey = 6</span>
</code></pre></div><ul><li>代码实现</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Diffie-Hellman</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createDiffieHellman <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>

<span class="token comment">// 客户端</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">createDiffieHellman</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> clientKey <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">generateKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// A</span>
<span class="token keyword">const</span> prime <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取素数 p</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// N</span>

<span class="token comment">// 服务器</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">createDiffieHellman</span><span class="token punctuation">(</span>prime<span class="token punctuation">,</span> generator<span class="token punctuation">)</span>
<span class="token keyword">const</span> serverKey <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">generateKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// B</span>

<span class="token comment">// 生成私钥</span>
<span class="token keyword">const</span> client_secret <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">computeSecret</span><span class="token punctuation">(</span>serverKey<span class="token punctuation">)</span>
<span class="token keyword">const</span> server_secret <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">computeSecret</span><span class="token punctuation">(</span>clientKey<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>client_secret<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> server_secret<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>ECDHE 算法</strong></p> <p>ECDHE 算法是在 DHE 算法的基础上利用了 <code>ECC 椭圆曲线</code>特性，可以用更少的计算量计算出公钥，以及最终的会话密钥。</p> <p>小红和小明使用 ECDHE 密钥交换算法的过程：</p> <ul><li>双方事先确定好使用 <code>哪种椭圆曲线</code>，和曲线上的 <code>基点 G</code>，这两个参数都是公开的；</li> <li>双方各自随机生成一个随机数作为<code>私钥d</code>，并与 <code>基点 G</code> 相乘得到<code>公钥Q（Q = dG）</code>，此时小红的公私钥为 Q1 和 d1，小明的公私钥为 Q2 和 d2；</li> <li>双方交换各自的公钥，最后小红计算点（x1，y1） = d1Q2，小明计算点（x2，y2） = d2Q1，由于椭圆曲线上是可以满足乘法交换和结合律，所以 d1Q2 = d1d2G = d2d1G = d2Q1 ，因此双方的 x 坐标是一样的，所以它是共享密钥，也就是会话密钥。</li></ul> <p>这个过程中，双方的私钥都是随机、临时生成的，都是不公开的，即使根据公开的信息（椭圆曲线、公钥、基点 G）也是很难计算出椭圆曲线上的离散对数（私钥）。</p> <h2 id="_3-密钥协商"><a href="#_3-密钥协商" class="header-anchor">#</a> 3. 密钥协商</h2> <h3 id="常见秘钥交换算法"><a href="#常见秘钥交换算法" class="header-anchor">#</a> 常见秘钥交换算法</h3> <ul><li>RSA</li> <li><strong>ECDHE(目前主流)</strong></li></ul> <p><img src="/study-record/assets/img/myxs.dea5907d.png" alt=""></p> <h2 id="_4-tls-握手过程"><a href="#_4-tls-握手过程" class="header-anchor">#</a> 4. <a href="https://mp.weixin.qq.com/s/U9SRLE7jZTB6lUZ6c8gTKg" target="_blank" rel="noopener noreferrer">TLS 握手过程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <h3 id="tls-rsa-握手-反复阅读熟记"><a href="#tls-rsa-握手-反复阅读熟记" class="header-anchor">#</a> TLS-RSA 握手(反复阅读熟记)</h3> <p><img src="/study-record/assets/img/rsa-handshake.2f8917fe.png" alt=""></p> <h3 id="tls-ecdhe-握手"><a href="#tls-ecdhe-握手" class="header-anchor">#</a> TLS-ECDHE 握手</h3> <p><img src="/study-record/assets/img/tls-handshake.8b407d83.png" alt=""></p> <h2 id="_5-tls-握手过程详解"><a href="#_5-tls-握手过程详解" class="header-anchor">#</a> 5. TLS 握手过程详解</h2> <table><thead><tr><th>TLS 四次握手</th> <th>RSA</th> <th>ECDHE</th></tr></thead> <tbody><tr><td>第一次</td> <td>Client Hello</td> <td>Client Hello</td></tr> <tr><td>第二次</td> <td>Server Hello<br>Server Certificate<br>Server Hello Done</td> <td>Server Hello<br>Server Certificate<br><strong>Server Key Exchange</strong><br>Server Hello Done</td></tr> <tr><td>第三次</td> <td>Client Key Exchange<br>Change Cipher Spec<br>Encrypted Handshake Message（Finishd）</td> <td>Client Key Exchange<br>Change Cipher Spec<br>Encrypted Handshake Message（Finishd）</td></tr> <tr><td>第四次</td> <td>Change Cipher Spec<br>Encrypted Handshake Message（Finishd）</td> <td>Change Cipher Spec<br>Encrypted Handshake Message（Finishd）</td></tr></tbody></table> <ul><li>总结
<ul><li>RSA 密钥协商算法「不支持」前向保密，ECDHE 密钥协商算法「<strong>支持</strong>」<strong>前向保密</strong>；</li> <li>使用了 RSA 密钥协商算法，TLS 完成<strong>四次握手后，才能进行应用数据传输</strong>，而对于 ECDHE 算法，客户端可以不用等服务端的最后一次 TLS 握手，就可以提前发出加密的 HTTP 数据，节省了一个消息的往返时间（这个是 RFC 文档规定的，具体原因文档没有说明，所以这点我也不太明白）；</li> <li>使用 ECDHE， 在 TLS 第 <strong>2 次握手中</strong>，会出现服务器端发出的「<strong>Server Key Exchange</strong>」消息，而 RSA 握手过程没有该消息；</li></ul></li></ul> <p>以下以 RSA 握手过程进行详细解读</p> <h3 id="_1-第一次握手-【client-hello】"><a href="#_1-第一次握手-【client-hello】" class="header-anchor">#</a> 1. 第一次握手 【<strong>Client Hello</strong>】</h3> <p><img src="/study-record/assets/img/clienthello.778e8409.png" alt=""></p> <p>客户端打招呼，主要发送了 <code>TLS 版本号</code>、<code>支持的加密套件列表</code>、<code>客户端随机数（Client Random）</code>，该随机数最后会被服务端保留，这是 <code>生成对称加密秘钥</code> 的材料之一</p> <h3 id="_2-第二次握手-【server-hello-server-certificate-server-hello-done】"><a href="#_2-第二次握手-【server-hello-server-certificate-server-hello-done】" class="header-anchor">#</a> 2. 第二次握手 【<strong>Server Hello + Server Certificate + Server Hello Done</strong>】</h3> <ul><li><p><strong>Server Hello</strong></p> <p>当服务端收到客户端的【Client Hello】消息后，会确认(ACK) TLS 版本号是否支持，和从密码套件列表中选择一个密码套件，以及生成随机数 <code>Server Random</code></p> <p>接着，返回【<strong>Server Hello</strong>】消息，消息里面有服务器确认的 <code>TLS 版本号</code>，也给出了<code>随机数（Server Random）</code>，然后从客户端的密码套件列表选择了一个<code>合适的密码套件</code></p> <p><img src="/study-record/assets/img/serverhello.08c5e84e.png" alt=""></p> <p>可以看到，服务端选择的密码套件是</p> <div class="language-js extra-class"><pre class="language-js"><code>“Cipher Suite<span class="token operator">:</span> <span class="token constant">TLS_RSA_WITH_AES_128_GCM_SHA256</span>”
</code></pre></div><p>套件基本格式：<strong>「密钥交换算法 + 签名算法 + 对称加密算法 + 摘要算法」</strong></p> <p>上述套件的意思是</p> <ul><li>由于 WITH 单词只有一个 RSA，则说明握手时密钥交换算法和签名算法都是使用 RSA</li> <li>握手后的通信使用 AES 对称算法，密钥长度 128 位，分组模式是 GCM</li> <li>摘要算法 SHA256 用于消息认证和产生随机数；</li></ul></li> <li><p><strong>Server Certificate</strong></p> <p>服务端为验证自己身份，发送 <code>Server Certificate</code> 消息给客户端，信息内包含证书</p> <p><img src="/study-record/assets/img/certificate.2f1fd20d.png" alt=""></p></li> <li><p><strong>Server Hello Done</strong></p> <p>服务端告诉客户端，消息传递完毕，本次招呼完毕</p> <p><img src="/study-record/assets/img/server-hello-done.0a60d7ba.png" alt=""></p></li></ul> <blockquote><p>二次握手中有几个关键事项，这里就不展开细讲了</p> <ol><li>客户端证书验证（见<a href="#_2-5-%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6">2.5 数字证书</a>）</li> <li>证书链</li></ol></blockquote> <h3 id="_3-第三次握手"><a href="#_3-第三次握手" class="header-anchor">#</a> 3. 第三次握手</h3> <ul><li><p><strong>Client Key Exchange</strong></p> <p>客户端验证完证书，可信则继续往下走。客户端生成新的 <code>随机数(pre-master)</code>,用服务器的 RSA 公钥进行加密，通过 <strong>Client Key Exchange</strong> 消息传给服务端</p> <p><img src="/study-record/assets/img/change-cipher-spec.3d709b69.png" alt=""></p> <p>服务端用 RSA 私钥解密，也得到了 pre-master</p> <p>至此，双方共享了3个随机数：</p> <ul><li>Client Random</li> <li>Server Random</li> <li>pre-master</li></ul> <p>双方基于3个随机数，生成会话秘钥 <strong>Master Secter（对称秘钥）</strong>，用于后续的加密通讯</p></li> <li><p><strong>Change Cipher Spec</strong></p> <p>客户端通过 <strong>Change Cipher Spec</strong> 消息告诉服务端接下来开始切换加密协议，之后都使用对称加密进行发消息</p> <p><img src="/study-record/assets/img/change-cipher-spec.3d709b69.png" alt=""></p></li> <li><p><strong>Encrypted Handshake Message（Finishd）</strong></p> <p>然后，客户端再发一个 <strong>Encrypted Handshake Message（Finishd）</strong> 消息，把之前所有发送的数据进行摘要，再用 <code>maste secret</code> 对称秘钥进行加密，让服务端做验证，验证加密通信是否可用及 TLS 握手信息是否被 篡改过</p> <p><img src="/study-record/assets/img/encrypted-handshake-message.916b3516.png" alt=""></p></li></ul> <h3 id="_4-第四次握手"><a href="#_4-第四次握手" class="header-anchor">#</a> 4. 第四次握手</h3> <p>也是进行 <strong>Change Cipher Spec</strong> 和 <strong>Encrypted Handshake Message（Finishd）</strong>，如果双方都验证加解密没问题，则握手正式完成</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-record/1.基础/计算机网络/http.html" class="prev">
        http
      </a></span> <span class="next"><a href="/study-record/1.基础/计算机网络/question.html">
        question
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-record/assets/js/app.17aac99d.js" defer></script><script src="/study-record/assets/js/2.016b014c.js" defer></script><script src="/study-record/assets/js/1.4d9187d3.js" defer></script><script src="/study-record/assets/js/11.fa712348.js" defer></script>
  </body>
</html>
