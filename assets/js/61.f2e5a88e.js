(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{283:function(t,s,a){"use strict";a.r(s);var n=a(6),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"mini-qiankun"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mini-qiankun"}},[t._v("#")]),t._v(" mini-qiankun")]),t._v(" "),s("h2",{attrs:{id:"github"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/WillianLiusHao/mini-qiankun/blob/main/understand.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"微前端的基本思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微前端的基本思路"}},[t._v("#")]),t._v(" 微前端的基本思路")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("监听路由变化")]),t._v(" "),s("ul",[s("li",[t._v("针对两种路由模式改写api\n"),s("ul",[s("li",[t._v("路由变化，需要卸载上个应用再加载下一个")])])])])]),t._v(" "),s("li",[s("p",[t._v("匹配路由应用")]),t._v(" "),s("ul",[s("li",[t._v("根据 activeRule 规则匹配子应用")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("加载子应用")])]),t._v(" "),s("ul",[s("li",[t._v("请求 html，获取子应用入口模板")]),t._v(" "),s("li",[t._v("获取 css、js，统一生成行内资源")]),t._v(" "),s("li",[t._v("把子应用的容器挂载到主应用中")]),t._v(" "),s("li",[t._v("eval 执行 js 资源")])])]),t._v(" "),s("li",[s("p",[t._v("渲染子应用")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("获取子应用导出的 "),s("code",[t._v("bootstrap mount unmount")]),t._v(" 等函数，执行")])])])])]),t._v(" "),s("h2",{attrs:{id:"拓展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拓展"}},[t._v("#")]),t._v(" 拓展")]),t._v(" "),s("blockquote",[s("p",[t._v("其实微前端框架就类比成一个 Vue 框架")])]),t._v(" "),s("ul",[s("li",[t._v("微前端子应用 => Vue 组件")]),t._v(" "),s("li",[t._v("微前端切换子应用 => Vue-router 路由")]),t._v(" "),s("li",[t._v("子应用生命周期 => 组件生命周期")])]),t._v(" "),s("h2",{attrs:{id:"基本流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本流程"}},[t._v("#")]),t._v(" 基本流程")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("主应用先定义好每个子应用的启动参数然后通过")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("registerMicroApps")]),t._v(" 进行应用的注册")]),t._v(" "),s("li",[s("code",[t._v("start")]),t._v(" 进行启动")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerMicroApps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue2App'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:8081'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("container")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("activeRule")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/vue2-cli-app'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("props")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'主应用传递的数据,你是vue2App'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue3App'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:8082'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("container")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("activeRule")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/vue3-cli-app'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("props")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'主应用传递的数据,你是vue3App'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("strat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里就启动微前端项目了")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[s("strong",[t._v("注册应用")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("qiankun")]),t._v(" 的 "),s("code",[t._v("registerMicroApps")]),t._v(" 在获取到子应用的初始化参数，经过简单的处理后，调用 "),s("code",[t._v("single-spa")]),t._v(" 的 "),s("code",[t._v("registerApplication")])]),t._v(" "),s("li",[s("code",[t._v("registerApplication")]),t._v(" 的第二个参数 "),s("code",[t._v("app")]),t._v("，是一个函数，函数可返回一系列子应用的生命周期，规定了子应用在 "),s("code",[t._v("single-spa")]),t._v(" 的不同生命周期中需要执行的生命周期函数")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * qiankun 主要就是靠这一步进行二开\n         * registerApplication 的第二个参数 app 是一个函数\n         * 返回一系列的生命周期函数，让 single-spa 在不同的生命周期中去执行这些方法\n        */")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这三个生命周期都是 事件队列，到时候 single-spa 会在相应的生命周期会依次执行队列中的事件")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" unmount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadApp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("bootstrap")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mount")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("unmount")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" unmount\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("activeWhen")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeRule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("customProps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 主应用传递给子应用的数据，通讯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("启动")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("qiankun")]),t._v(" 的 "),s("code",[t._v("start")]),t._v(" 做一些 "),s("code",[t._v("框架配置 / 沙箱代理配置 / 预加载配置")])]),t._v(" "),s("li",[t._v("最后调用 "),s("code",[t._v("single-spa")]),t._v(" 的 "),s("code",[t._v("startSingleSpa")]),t._v(" 启动项目")])])])]),t._v(" "),s("h2",{attrs:{id:"single-spa-核心功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#single-spa-核心功能"}},[t._v("#")]),t._v(" "),s("strong",[t._v("single-spa 核心功能")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 整个 single-spa 主要做了如下几个事情\n * 1. 全局定义子应用的所有状态，初始化子应用状态为 待加载\n * 2. 根据路由的状态和应用当前状态 可将子应用分为如下几类\n *    - 待加载： 路由匹配 & 状态为加载前\n *    - 待挂载： 路由匹配 & （状态为加载前 | 状态为已卸载)\n *    - 待卸载： 路由不匹配 & 状态为挂载\n * 3. 改写路由的 popstate/pushState 等方法\n * 4. 每次路由切换，路由事件监听到变化，调用reload，把不同类别的子应用分别执行不同的方法\n *    - 其中，状态为 BEFORE_LOAD 的应用被归为 toLoadApp 类型,会执行 loadApp方法，获取外部传入的 app 不同生命周期的 事件列表\n *    - 其中，第二点中归为待挂载类型的子应用，会执行 bootStrapAndMountApp 方法，依次执行 bootstrap 和 mount 生命周期时间列表\n */")]),t._v("\n")])])]),s("h2",{attrs:{id:"loadapp-是如何拓展-single-spa的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loadapp-是如何拓展-single-spa的"}},[t._v("#")]),t._v(" "),s("strong",[t._v("loadApp 是如何拓展 single-spa的")])])])}),[],!1,null,null,null);s.default=r.exports}}]);