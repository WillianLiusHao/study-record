(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{238:function(t,a,s){"use strict";s.r(a);var e=s(6),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"webpack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack"}},[t._v("#")]),t._v(" Webpack")]),t._v(" "),a("h2",{attrs:{id:"重点难点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重点难点"}},[t._v("#")]),t._v(" 重点难点")]),t._v(" "),a("ul",[a("li",[t._v("模块化")]),t._v(" "),a("li",[t._v("loader 机制")]),t._v(" "),a("li",[t._v("plugin 机制")]),t._v(" "),a("li",[t._v("工作流程")])]),t._v(" "),a("h2",{attrs:{id:"打包工具的需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包工具的需求"}},[t._v("#")]),t._v(" 打包工具的需求")]),t._v(" "),a("ul",[a("li",[t._v("将散落的模块打包到一起")]),t._v(" "),a("li",[t._v("能够编译代码的新特性")]),t._v(" "),a("li",[t._v("能够支持不同种类的前端资源模块")])]),t._v(" "),a("h2",{attrs:{id:"工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[t._v("#")]),t._v(" 工作流程")]),t._v(" "),a("h3",{attrs:{id:"_1-初始化阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化阶段"}},[t._v("#")]),t._v(" 1.初始化阶段")]),t._v(" "),a("ul",[a("li",[t._v("初始化参数：从"),a("code",[t._v("配置文件")]),t._v("、"),a("code",[t._v("配置对象")]),t._v(" 和 "),a("code",[t._v("Shell 参数")]),t._v(" 中读取并与默认参数进行合并，组合成最终使用的参数。")]),t._v(" "),a("li",[t._v("创建编译对象：用上一步得到的参数创建 "),a("strong",[t._v("Compiler 对象")]),t._v("。")]),t._v(" "),a("li",[t._v("初始化编译环境：包括注入内置插件、注册各种模块工厂、初始化 RuleSet 集合、加载配置的插件等。")])]),t._v(" "),a("h3",{attrs:{id:"_2-构建阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建阶段"}},[t._v("#")]),t._v(" 2.构建阶段")]),t._v(" "),a("ul",[a("li",[t._v("开始编译：执行 Compiler 对象的 "),a("code",[t._v("run")]),t._v(" 方法，创建 Compilation 对象。")]),t._v(" "),a("li",[t._v("确认编译入口：进入 entryOption 阶段，读取配置的 Entries，递归遍历所有的入口文件，调用 Compilation.addEntry 将入口文件转换为 Dependency 对象。")]),t._v(" "),a("li",[t._v("编译模块（make）： 调用 normalModule 中的 build 开启构建，从 entry 文件开始，调用 loader 对模块进行转译处理，然后调用 JS 解释器（acorn）将内容转化为 AST 对象，然后递归分析依赖，依次处理全部文件。")]),t._v(" "),a("li",[t._v("完成模块编译：在上一步处理好所有模块后，得到模块编译产物和 "),a("code",[t._v("依赖图谱")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"_3-生成阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-生成阶段"}},[t._v("#")]),t._v(" 3.生成阶段")]),t._v(" "),a("ul",[a("li",[t._v("输出资源（seal）：根据入口和模块之间的依赖关系，组装成多个包含多个模块的 Chunk，再把每个 Chunk 转换成一个 Asset 加入到输出列表，这步是可以修改输出内容的最后机会。")]),t._v(" "),a("li",[t._v("写入文件系统（emitAssets）：确定好输出内容后，根据配置的 output 将内容写入文件系统。")])]),t._v(" "),a("h2",{attrs:{id:"plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin"}},[t._v("#")]),t._v(" plugin")]),t._v(" "),a("blockquote",[a("p",[t._v("核心原理就是 基于 tapable 的发布订阅模式")])]),t._v(" "),a("p",[t._v("每个plugin 是一个类，提供 "),a("code",[t._v("apply")]),t._v("方法")]),t._v(" "),a("p",[t._v("webpack 在执行过程中会调用 "),a("code",[t._v("apply")]),t._v(" 方法，且会将 "),a("code",[t._v("compiler")]),t._v(" 实例传入")]),t._v(" "),a("p",[t._v("compiler 贯穿 webpack 的整个生命周期，会抛出一些生命周期的钩子，插件就可以 "),a("code",[t._v("在钩子上注册事件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("compiler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  compiler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hooks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myPlugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... do something")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loader"}},[t._v("#")]),t._v(" loader")]),t._v(" "),a("h3",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("h4",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.css$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'style-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"多个loader的执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多个loader的执行顺序"}},[t._v("#")]),t._v(" 多个loader的执行顺序")]),t._v(" "),a("ul",[a("li",[t._v("从后往前")])])])}),[],!1,null,null,null);a.default=r.exports}}]);