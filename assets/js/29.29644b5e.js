(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{206:function(t,s,e){t.exports=e.p+"assets/img/prebuild.86305338.png"},254:function(t,s,e){"use strict";e.r(s);var v=e(6),a=Object(v.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"vite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vite"}},[t._v("#")]),t._v(" vite")]),t._v(" "),s("ol",[s("li",[t._v("请简述Vite的工作原理")]),t._v(" "),s("li",[t._v("Vite的优点是什么？")]),t._v(" "),s("li",[t._v("请简述Vite的HMR实现原理")]),t._v(" "),s("li",[t._v("如何实现Vite的插件开发？")]),t._v(" "),s("li",[t._v("如何使用Vite实现多页应用？")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("img",{attrs:{src:e(206),alt:""}})]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vite 1.0 => vite 2.0  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("本地服务器：koa")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" connect   \n预优化：rollup "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("插件")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" esbuild\n")])])]),s("h2",{attrs:{id:"工程化的痛点和解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工程化的痛点和解决方案"}},[t._v("#")]),t._v(" 工程化的痛点和解决方案")]),t._v(" "),s("ul",[s("li",[t._v("模块化需求\n"),s("ul",[s("li",[t._v("提供模块加载方案")]),t._v(" "),s("li",[t._v("兼容不同模块规范")])])]),t._v(" "),s("li",[t._v("语法转译\n"),s("ul",[s("li",[t._v("高级语法转译 sass、ts")]),t._v(" "),s("li",[t._v("资源加载，图片/字体等")])])]),t._v(" "),s("li",[t._v("产物质量\n"),s("ul",[s("li",[t._v("产物压缩、代码混淆、tree shaking、语法降级")])])]),t._v(" "),s("li",[t._v("开发效率\n"),s("ul",[s("li",[t._v("HRM、构建提速")])])])]),t._v(" "),s("h2",{attrs:{id:"功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[t._v("#")]),t._v(" 功能")]),t._v(" "),s("ul",[s("li",[t._v("预构建 和 依赖解析\n"),s("ul",[s("li",[t._v("预构建：依赖统一转为 ESM 模式，由 "),s("code",[t._v("esbuild")]),t._v(" 完成")]),t._v(" "),s("li",[t._v("依赖解析：重写 url")])])]),t._v(" "),s("li",[t._v("模块热替换")]),t._v(" "),s("li",[t._v("TS 支持\n"),s("ul",[s("li",[t._v("天然支持 "),s("code",[t._v(".ts")]),t._v("文件，内部会进行 ts 的转译工作")])])])]),t._v(" "),s("h2",{attrs:{id:"架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[t._v("#")]),t._v(" 架构")]),t._v(" "),s("blockquote",[s("p",[t._v("性能利器：Esbuild")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("依赖于构建 - bundle 工具")]),t._v(" "),s("ul",[s("li",[t._v("优点\n"),s("ul",[s("li",[t._v("快，极致的快！")])])]),t._v(" "),s("li",[t._v("缺点\n"),s("ul",[s("li",[t._v("不支持 "),s("code",[t._v("ES5")]),t._v(", 低版本浏览器无法运行")]),t._v(" "),s("li",[t._v("不提供操作打包产物的接口")]),t._v(" "),s("li",[t._v("不支持自定义的 "),s("code",[t._v("code splitting")]),t._v("，降低拆包优化的灵活了")])])])])]),t._v(" "),s("li",[s("p",[t._v("单文件编译 - ts 和 jsx 的编译工具")])]),t._v(" "),s("li",[s("p",[t._v("代码压缩 - 压缩工具")])])]),t._v(" "),s("h2",{attrs:{id:"核心原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心原理"}},[t._v("#")]),t._v(" 核心原理")]),t._v(" "),s("ol",[s("li",[t._v("模块声明")])]),t._v(" "),s("p",[t._v("在 index.html 入口处将 main.js 的 script 标签加入 "),s("code",[t._v('type="module"')]),t._v("属性，声明是一个模块")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),t._v(" src"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("这样通过src或import导入的文件将会发起http请求；")]),t._v(" "),s("p",[t._v("vite 服务器会拦截这些请求，并将请求文件进行特别处理。")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("裸模块替换")])]),t._v(" "),s("p",[t._v("将裸模块替换成 node_modules 下的模块")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v(" 会转换成 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/@modules/vue'")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("解析/@modules")])]),t._v(" "),s("p",[t._v("接下里将/@modules解析为真正的文件地址，并返回给浏览器。")]),t._v(" "),s("p",[t._v("通过 import 导入的文件 webpack 会去 node_modules/包名/package.json 文件内找 module 属性,得到真正的原始模块地址。")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("解析单文件（SFC）组件")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("template "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("@vue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("compiler"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dom\nscript "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("@vue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("compiler"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("sfc\nstyle "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" updateStyle\n")])])]),s("h2",{attrs:{id:"具体功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体功能"}},[t._v("#")]),t._v(" 具体功能")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("模块解析")])])]),t._v(" "),s("p",[t._v("利用 "),s("code",[t._v("es-module-lexer")]),t._v(" 进行词法分析，可快速得出 "),s("code",[t._v("import")]),t._v(" 和 "),s("code",[t._v("export")]),t._v(" 语句")]),t._v(" "),s("ul",[s("li",[t._v("裸模块导入 "),s("code",[t._v("vue => /@modules/vue.js")])]),t._v(" "),s("li",[t._v("相对路径转绝对路径\n"),s("ul",[s("li",[t._v("js")]),t._v(" "),s("li",[t._v("css")])])]),t._v(" "),s("li",[t._v("加时间戳，防止浏览器缓存")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("预构建")])])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("why?")]),t._v(" "),s("ul",[s("li",[t._v("因为依赖了浏览器的 es 模块解析功能，所以必须保证所有的依赖都是 esm 规范的（但仍有许多是 cjs 的第三方模块）")]),t._v(" "),s("li",[t._v("esm 请求会造成瀑布流")])])]),t._v(" "),s("li",[s("p",[t._v("how?")]),t._v(" "),s("ul",[s("li",[t._v("将其他格式(如 UMD 和 CommonJS)的产物转换为 ESM 格式，使其在浏览器通过 "),s("code",[t._v('<script type="module"><script>')]),t._v(" 的方式正常加载。")]),t._v(" "),s("li",[t._v("打包第三方库的代码，将各个第三方库分散的文件合并到一起，减少 HTTP 请求数量，避免页面加载性能劣化。")])])]),t._v(" "),s("li",[s("p",[t._v("tips")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("include")]),t._v(" "),s("p",[t._v("在某些"),s("code",[t._v("动态 import")]),t._v("的场景下，依赖无法加入预构建，此时需要加入到"),s("code",[t._v("include")]),t._v("中强制预构建")])])])])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("组件渲染（.vue)")])])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("热替换（Hot Module Replacement）")])])])])}),[],!1,null,null,null);s.default=a.exports}}]);