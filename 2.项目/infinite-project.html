<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>infinite-project | 前端随笔 WillianLiusHao</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="勤学如春起之苗，不见其增，日有所长">
    
    <link rel="preload" href="/study-record/assets/css/0.styles.ee9d39b9.css" as="style"><link rel="preload" href="/study-record/assets/js/app.17aac99d.js" as="script"><link rel="preload" href="/study-record/assets/js/2.016b014c.js" as="script"><link rel="preload" href="/study-record/assets/js/1.4d9187d3.js" as="script"><link rel="preload" href="/study-record/assets/js/60.e7406693.js" as="script"><link rel="prefetch" href="/study-record/assets/js/10.36503388.js"><link rel="prefetch" href="/study-record/assets/js/11.fa712348.js"><link rel="prefetch" href="/study-record/assets/js/12.276efbb7.js"><link rel="prefetch" href="/study-record/assets/js/13.d963e8a7.js"><link rel="prefetch" href="/study-record/assets/js/14.d7577f19.js"><link rel="prefetch" href="/study-record/assets/js/15.cc1f798a.js"><link rel="prefetch" href="/study-record/assets/js/16.0291a868.js"><link rel="prefetch" href="/study-record/assets/js/17.0a30da7e.js"><link rel="prefetch" href="/study-record/assets/js/18.0cfbb48c.js"><link rel="prefetch" href="/study-record/assets/js/19.0e21e7df.js"><link rel="prefetch" href="/study-record/assets/js/20.03daea74.js"><link rel="prefetch" href="/study-record/assets/js/21.3b8bed13.js"><link rel="prefetch" href="/study-record/assets/js/22.044c0ee0.js"><link rel="prefetch" href="/study-record/assets/js/23.2e58d861.js"><link rel="prefetch" href="/study-record/assets/js/24.5d91c0ed.js"><link rel="prefetch" href="/study-record/assets/js/25.ecbc19e1.js"><link rel="prefetch" href="/study-record/assets/js/26.ea32b772.js"><link rel="prefetch" href="/study-record/assets/js/27.7994195c.js"><link rel="prefetch" href="/study-record/assets/js/28.1d2d8781.js"><link rel="prefetch" href="/study-record/assets/js/29.29644b5e.js"><link rel="prefetch" href="/study-record/assets/js/3.babd7043.js"><link rel="prefetch" href="/study-record/assets/js/30.c1b69b54.js"><link rel="prefetch" href="/study-record/assets/js/31.b8531d02.js"><link rel="prefetch" href="/study-record/assets/js/32.1a3d2119.js"><link rel="prefetch" href="/study-record/assets/js/33.4073fb14.js"><link rel="prefetch" href="/study-record/assets/js/34.5873267c.js"><link rel="prefetch" href="/study-record/assets/js/35.22f30e0a.js"><link rel="prefetch" href="/study-record/assets/js/36.9acadcf0.js"><link rel="prefetch" href="/study-record/assets/js/37.514fb866.js"><link rel="prefetch" href="/study-record/assets/js/38.cfd8eaf8.js"><link rel="prefetch" href="/study-record/assets/js/39.b18930b7.js"><link rel="prefetch" href="/study-record/assets/js/4.fa802c58.js"><link rel="prefetch" href="/study-record/assets/js/40.ce709979.js"><link rel="prefetch" href="/study-record/assets/js/41.2042214a.js"><link rel="prefetch" href="/study-record/assets/js/42.87b852a8.js"><link rel="prefetch" href="/study-record/assets/js/43.b4287906.js"><link rel="prefetch" href="/study-record/assets/js/44.6bf10f9a.js"><link rel="prefetch" href="/study-record/assets/js/45.25eeefa0.js"><link rel="prefetch" href="/study-record/assets/js/46.0f8cb01f.js"><link rel="prefetch" href="/study-record/assets/js/47.288a54bb.js"><link rel="prefetch" href="/study-record/assets/js/48.b613c839.js"><link rel="prefetch" href="/study-record/assets/js/49.d18be6a8.js"><link rel="prefetch" href="/study-record/assets/js/5.87700c1c.js"><link rel="prefetch" href="/study-record/assets/js/50.400520f0.js"><link rel="prefetch" href="/study-record/assets/js/51.7eab7fad.js"><link rel="prefetch" href="/study-record/assets/js/52.caaed993.js"><link rel="prefetch" href="/study-record/assets/js/53.55fabd90.js"><link rel="prefetch" href="/study-record/assets/js/54.1a826e47.js"><link rel="prefetch" href="/study-record/assets/js/55.e0c40590.js"><link rel="prefetch" href="/study-record/assets/js/56.42f5fc5f.js"><link rel="prefetch" href="/study-record/assets/js/57.8f30f2af.js"><link rel="prefetch" href="/study-record/assets/js/58.63b92872.js"><link rel="prefetch" href="/study-record/assets/js/59.bd09ccb3.js"><link rel="prefetch" href="/study-record/assets/js/6.9086b17c.js"><link rel="prefetch" href="/study-record/assets/js/61.f2e5a88e.js"><link rel="prefetch" href="/study-record/assets/js/62.0b65291e.js"><link rel="prefetch" href="/study-record/assets/js/63.8de3fdca.js"><link rel="prefetch" href="/study-record/assets/js/64.4e11deef.js"><link rel="prefetch" href="/study-record/assets/js/65.54d039db.js"><link rel="prefetch" href="/study-record/assets/js/66.84db7a63.js"><link rel="prefetch" href="/study-record/assets/js/67.1c39ed43.js"><link rel="prefetch" href="/study-record/assets/js/68.c06e0761.js"><link rel="prefetch" href="/study-record/assets/js/69.ab2a8f77.js"><link rel="prefetch" href="/study-record/assets/js/7.8ac123f2.js"><link rel="prefetch" href="/study-record/assets/js/70.4ac2a1eb.js"><link rel="prefetch" href="/study-record/assets/js/71.a10a64a1.js"><link rel="prefetch" href="/study-record/assets/js/72.f5ee9344.js"><link rel="prefetch" href="/study-record/assets/js/73.ce032dd2.js"><link rel="prefetch" href="/study-record/assets/js/74.0867294f.js"><link rel="prefetch" href="/study-record/assets/js/75.a2ebcace.js"><link rel="prefetch" href="/study-record/assets/js/76.c3eb5991.js"><link rel="prefetch" href="/study-record/assets/js/77.06a7f50c.js"><link rel="prefetch" href="/study-record/assets/js/78.5fb20fe2.js"><link rel="prefetch" href="/study-record/assets/js/79.f6266092.js"><link rel="prefetch" href="/study-record/assets/js/80.d3237485.js"><link rel="prefetch" href="/study-record/assets/js/81.59c4725f.js"><link rel="prefetch" href="/study-record/assets/js/82.d198b1a8.js"><link rel="prefetch" href="/study-record/assets/js/83.88fb1a26.js"><link rel="prefetch" href="/study-record/assets/js/84.43f20fa1.js"><link rel="prefetch" href="/study-record/assets/js/85.2ea9262b.js"><link rel="prefetch" href="/study-record/assets/js/86.d3f5931d.js"><link rel="prefetch" href="/study-record/assets/js/87.b1833438.js"><link rel="prefetch" href="/study-record/assets/js/88.4359c8a8.js"><link rel="prefetch" href="/study-record/assets/js/89.2c40610e.js"><link rel="prefetch" href="/study-record/assets/js/90.5546c4ab.js"><link rel="prefetch" href="/study-record/assets/js/91.22180d3b.js"><link rel="prefetch" href="/study-record/assets/js/92.15962496.js"><link rel="prefetch" href="/study-record/assets/js/vendors~docsearch.32379f2b.js">
    <link rel="stylesheet" href="/study-record/assets/css/0.styles.ee9d39b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-record/" class="home-link router-link-active"><!----> <span class="site-name">前端随笔 WillianLiusHao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/WillianLiusHao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/WillianLiusHao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1.基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>2.项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-record/2.项目/aboutme.html" class="sidebar-link">aboutme</a></li><li><a href="/study-record/2.项目/cms.html" class="sidebar-link">cms</a></li><li><a href="/study-record/2.项目/infinite-project.html" class="active sidebar-link">infinite-project</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#lightning" class="sidebar-link">lightning</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_1-编辑页的设计-组件的设计-单向数据流" class="sidebar-link">1. 编辑页的设计，组件的设计，单向数据流？</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_2-jssdk-事件上报-错误监控-行为回溯" class="sidebar-link">2. jssdk：事件上报 / 错误监控 / 行为回溯</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_3-权限设计" class="sidebar-link">3. 权限设计</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_4-husky-配置git-提供的提交时生命周期-限制提交的分支-文件夹" class="sidebar-link">4. husky（配置git 提供的提交时生命周期，限制提交的分支/文件夹）</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_5-脚本-建议单独写个小项目作为开发cli工具-涉及vue-的工作原理" class="sidebar-link">5. 脚本（建议单独写个小项目作为开发cli工具,涉及vue 的工作原理）</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_6-性能优化" class="sidebar-link">6. 性能优化</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_7-打包资源上传-cdn-webpack-插件" class="sidebar-link">7. 打包资源上传 cdn webpack 插件</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#项目总结" class="sidebar-link">项目总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#desktop-micro" class="sidebar-link">desktop-micro</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_1-monorepo" class="sidebar-link">1. Monorepo</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_2-复杂的权限设计" class="sidebar-link">2. 复杂的权限设计</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#项目总结-2" class="sidebar-link">项目总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#eams、uni-app、小蓝书、官网" class="sidebar-link">eams、uni-app、小蓝书、官网</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_1-制定代码和git规范-standard-规范-、自动化版本管理" class="sidebar-link">1. 制定代码和git规范(standard 规范)、自动化版本管理</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_2-echarts封装" class="sidebar-link">2. echarts封装</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_3-pinia-持久化存储-pinia-plugin-persistedstate" class="sidebar-link">3. pinia + 持久化存储(pinia-plugin-persistedstate)</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_4-首屏加载优化" class="sidebar-link">4. 首屏加载优化</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_5-html2canvas-pdfjs" class="sidebar-link">5. html2canvas pdfjs</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_6-多请求下loading-的展示和关闭" class="sidebar-link">6. 多请求下loading 的展示和关闭</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#_7-批量导出" class="sidebar-link">7. 批量导出</a></li><li class="sidebar-sub-header"><a href="/study-record/2.项目/infinite-project.html#项目总结-3" class="sidebar-link">项目总结</a></li></ul></li></ul></li><li><a href="/study-record/2.项目/jssdk-monitor.html" class="sidebar-link">jssdk-monitor</a></li><li><a href="/study-record/2.项目/lightning.html" class="sidebar-link">lightning</a></li><li><a href="/study-record/2.项目/mini-qiankun.html" class="sidebar-link">mini-qiankun</a></li><li><a href="/study-record/2.项目/mini-router4.html" class="sidebar-link">mini-router4</a></li><li><a href="/study-record/2.项目/mini-vite.html" class="sidebar-link">mini-vite</a></li><li><a href="/study-record/2.项目/qd-project.html" class="sidebar-link">qd-project</a></li><li><a href="/study-record/2.项目/vite-plugin-generate-routes.html" class="sidebar-link">vite-plugin-generate-routes</a></li><li><a href="/study-record/2.项目/vue3-scroll-virtual-list.html" class="sidebar-link">vue3-scroll-virtual-list</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3.算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4.日常</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5.脑图</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/study-record/" aria-current="page" class="sidebar-link">index</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="infinite-project"><a href="#infinite-project" class="header-anchor">#</a> infinite-project</h1> <h2 id="lightning"><a href="#lightning" class="header-anchor">#</a> lightning</h2> <h3 id="_1-编辑页的设计-组件的设计-单向数据流"><a href="#_1-编辑页的设计-组件的设计-单向数据流" class="header-anchor">#</a> 1. 编辑页的设计，组件的设计，单向数据流？</h3> <h3 id="_2-jssdk-事件上报-错误监控-行为回溯"><a href="#_2-jssdk-事件上报-错误监控-行为回溯" class="header-anchor">#</a> 2. jssdk：事件上报 / 错误监控 / 行为回溯</h3> <ul><li>错误监控
<ul><li>脚本执行报错
<ul><li>报错信息</li> <li>报错次数</li> <li>设备类型(android / ios)</li></ul></li> <li>资源加载报错
<ul><li>资源的地址</li> <li>资源的类型</li> <li>报错次数</li></ul></li> <li>接口请求报错
<ul><li>接口地址</li> <li>页面加载速度</li></ul></li></ul></li> <li>事件上报
<ul><li>活动页关键节点埋点（<code>定义一套固定的事件列表，每个组件通过可视化选择上报事件</code>）</li> <li>桑基图回溯</li></ul></li> <li>行为回溯
<ul><li>录屏</li></ul></li></ul> <h3 id="_3-权限设计"><a href="#_3-权限设计" class="header-anchor">#</a> 3. 权限设计</h3> <ul><li>登录权限(单点登录)</li> <li>页面权限(路由控制)
<ul><li>后端数据库存对应用户的路由权限，然后在全局的路由守卫中对页面进行过滤</li></ul></li> <li>功能权限(<code>自定义指令 v-auth</code>)</li></ul> <h3 id="_4-husky-配置git-提供的提交时生命周期-限制提交的分支-文件夹"><a href="#_4-husky-配置git-提供的提交时生命周期-限制提交的分支-文件夹" class="header-anchor">#</a> 4. husky（配置git 提供的提交时生命周期，限制提交的<code>分支</code>/<code>文件夹</code>）</h3> <ul><li><code>husky</code> - <code>hooks</code> <ul><li>post-checkout</li> <li>pre-commit</li> <li>commit-msg</li></ul></li> <li>child_process - <code>spawn</code>：命令行执行库</li> <li>chalk：输出带颜色的log</li> <li>process：进程控制</li></ul> <h3 id="_5-脚本-建议单独写个小项目作为开发cli工具-涉及vue-的工作原理"><a href="#_5-脚本-建议单独写个小项目作为开发cli工具-涉及vue-的工作原理" class="header-anchor">#</a> 5. 脚本（<strong>建议单独写个小项目作为开发cli工具,涉及vue 的工作原理</strong>）</h3> <ul><li>打包模板 yarn template</li> <li>启动模板 yarn serve</li> <li>打包项目 yarn build</li></ul> <h3 id="_6-性能优化"><a href="#_6-性能优化" class="header-anchor">#</a> 6. 性能优化</h3> <ul><li><strong><code>性能优化常见手段</code></strong></li> <li><strong><code>首屏优化： 关键渲染路径</code></strong> <ul><li>懒加载，预加载，代码压缩gzip</li> <li>性能优化指标（FP,FCP,LCP）</li></ul></li></ul> <h3 id="_7-打包资源上传-cdn-webpack-插件"><a href="#_7-打包资源上传-cdn-webpack-插件" class="header-anchor">#</a> 7. 打包资源上传 cdn webpack 插件</h3> <h3 id="项目总结"><a href="#项目总结" class="header-anchor">#</a> 项目总结</h3> <h4 id="难点-亮点"><a href="#难点-亮点" class="header-anchor">#</a> 难点/亮点</h4> <blockquote><ol><li><strong>组件开发设计、组件数据处理（数据流问题）</strong></li></ol></blockquote> <ul><li>组件的分类
<ul><li>全局组件</li> <li>业务组件
<ul><li>主体展示</li> <li>配置编辑器</li> <li>样式编辑器</li></ul></li> <li>样式组件</li></ul></li></ul> <blockquote><ol start="2"><li><strong>模板配置的变化追踪</strong></li></ol></blockquote> <ul><li>对象的变化
<ul><li>增</li> <li>删</li> <li>改</li></ul></li> <li>数组的变化
<ul><li>数组长度变化</li> <li>数组增删</li></ul></li></ul> <blockquote><ol start="3"><li><strong>一次性能优化</strong></li></ol></blockquote> <ul><li>优化 pdf和弹层组件（体积大大缩小）
<ul><li>pdf（展示的时候才进行转化和渲染）</li> <li>弹层组件（按需加载）</li></ul></li></ul> <h4 id="待优化"><a href="#待优化" class="header-anchor">#</a> 待优化</h4> <h4 id="设计思路"><a href="#设计思路" class="header-anchor">#</a> 设计思路</h4> <h4 id="运作流程"><a href="#运作流程" class="header-anchor">#</a> 运作流程</h4> <h4 id="相关问题"><a href="#相关问题" class="header-anchor">#</a> 相关问题</h4> <blockquote><p>当时为什么 sdk 不用开源的项目，要自己搞一个？</p></blockquote> <h2 id="desktop-micro"><a href="#desktop-micro" class="header-anchor">#</a> desktop-micro</h2> <h3 id="_1-monorepo"><a href="#_1-monorepo" class="header-anchor">#</a> 1. Monorepo</h3> <ul><li><p>优点</p> <ul><li>易于代码复用：所有项目代码集中于单一仓库，易于抽离出共用的业务组件或工具</li> <li>易于依赖管理：依赖版本统一管理</li></ul></li> <li><p>yarn + workspace</p> <ul><li>避免重复安装包，减少了磁盘空间的占用，并降低了构建时间；</li> <li>内部代码可以彼此相互引用</li></ul></li> <li><p>配置</p> <ul><li>根目录 package.json
<ul><li><code>workspaces</code> 字段，定义哪个目录下为子项目</li> <li><code>private =&gt; true</code>，防止误将仓库发布</li></ul></li> <li>.eslintrc / .stylelintrc 等配置文件 下通过,根目录配置全局的一套方案，子应用通过 <code>extends</code> 字段获取父应用的相关配置</li></ul></li></ul> <h3 id="_2-复杂的权限设计"><a href="#_2-复杂的权限设计" class="header-anchor">#</a> 2. 复杂的权限设计</h3> <p>（主应用控制，进入主应用后，获取用户角色和权限列表和数据列表，过滤路由列表只渲染特定的页面和限制接口数据）</p> <ul><li>应用权限
<ul><li>逻辑定义上：角色的权限是固定的，由系统管理员规定，每个角色拥有不同的<code>应用权限</code>，如果某用户想拥有多个功能，则分配多个权限</li> <li>实现上：每个路由菜单和功能按钮会有 <code>路径path</code> 和 <code>唯一标识code</code>，统一成一个数组传到后端，这就决定了这个用户应用权限
<ul><li>其中<code>路由菜单</code>通过 <code>beforeRouterEnter</code> 钩子过滤</li> <li><code>功能按钮</code>通过<code>自定义指令</code>实现</li></ul></li></ul></li> <li>数据权限
<ul><li>数据权限是根这用户走的，每个用户的数据权限不一致，决定了该用户在同一模块下可见的数据（一般都是按自己的项目走)</li></ul></li></ul> <h3 id="项目总结-2"><a href="#项目总结-2" class="header-anchor">#</a> 项目总结</h3> <h4 id="项目难点、亮点"><a href="#项目难点、亮点" class="header-anchor">#</a> 项目难点、亮点</h4> <blockquote><ol><li>基础建设上（组件的二次封装）</li></ol></blockquote> <ul><li>table 组件（保证通用性前提下的简易性设计，<code>个性化和通用性</code> 两者的权衡）
<ul><li>props: fields（搜索） / columns（表格列） / toolbar（拓展操作） / paging（分页） / api（数据获取）</li> <li>event: <code>列排序</code> / <code>展开行</code> / <code>展开行二次排序</code></li></ul></li> <li>搜索条件组件
<ul><li>类型多样：下拉(单选/多选/分组) / 输入 / 日期 / 城市选择</li> <li>数据预加载：把该用户下有权数据渲染到对应的组件选项中</li> <li>通讯：组件和表单组件的结合，怎么通讯更合适</li></ul></li></ul> <blockquote><ol start="2"><li>业务上</li></ol></blockquote> <ul><li>复杂度高（融合了公司核心业务后台，推到8年+的产品）</li> <li>数据量大（百万级别）</li> <li>功能性强（展开列/二次排序/自定义列/高级搜索等）
<ul><li><p><strong>高级搜索，动态渲染搜索表单</strong></p> <ul><li>描述：活动默认可搜索的字段是固定的，需要具体搜索某个字段数据的时候需要使用到</li> <li>难点
<ul><li>渲染方面（<code>动态渲染搜索表单</code>）
<ol><li>每个项目的字段是不同的，导致<code>可搜索的字段需要动态配置</code>（全放出来太多了，有100多个字段）</li> <li>后端存储当前项目搜索字段的配置，后端返回后，前端要<code>动态渲染搜索表单</code></li> <li>如果字段是统一类型还好，但字段分为<code>6种类型(文本框、时间范围、城市选择、下拉框、值范围)</code>，不同类型要渲染不同组件（尤其时间范围和城市选择）</li></ol></li> <li>传值方面（<code>数据处理</code>）
<ol><li>用户在不同类型表单组件输入值后，前端需要将值根据不同的表单类型按照不同处理方式，然后拼接上字段类型传给后端</li></ol></li></ul></li></ul></li> <li><p><strong>自定义列，动态渲染表格列</strong></p> <ul><li>描述：表格会有默认的所有项目都存在的列字段，用户可以自定义要展示的列</li> <li>难点
<ol><li>字段不固定：列字段是后端返回的，不是固定的数据字典（不同项目活动字段不同）</li> <li>字段渲染：配置好要展示的列后，列要怎么渲染是个头疼的问题</li></ol> <ul><li>将常规字段按照字段类型定义了内容渲染规则</li> <li>对所有特殊字段写了一份渲染规则</li></ul> <ol start="3"><li>字段排序？存储？</li></ol> <ul><li>通过 sortable拖拽排序</li> <li>存储在 localstorage</li></ul> <ol start="4"><li>列宽问题(渲染内容过长，不美观)</li></ol> <ul><li>处理完列数据后，在重新渲染表格的时候，遍历表格内容，获取字段列中最长的内容（根据中英文和数字分别计算长度，进而控制列宽）</li></ul></li></ul></li></ul></li></ul> <h4 id="待优化-2"><a href="#待优化-2" class="header-anchor">#</a> 待优化</h4> <h4 id="设计思路-2"><a href="#设计思路-2" class="header-anchor">#</a> 设计思路</h4> <h4 id="运作流程-2"><a href="#运作流程-2" class="header-anchor">#</a> 运作流程</h4> <h4 id="相关问题-2"><a href="#相关问题-2" class="header-anchor">#</a> 相关问题</h4> <blockquote><p>Q1：Why not Iframe？
<a href="https://www.yuque.com/kuitos/gky7yw/gesexv" target="_blank" rel="noopener noreferrer">Why Not Iframe？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>Q2：复杂的权限设计？</p></blockquote> <p>分两大模块</p> <ul><li>应用权限</li> <li>数据权限（贯穿所有应用，以企业为维度，不同的项目运营同学只看自己项目的数据）</li></ul> <p>用户的权限取决于角色的权限，角色的权限由树状结构存储(path,code,level)</p> <p>路由由主应用控制，当请求获取到对应用户的权限后，动态渲染菜单</p> <blockquote><p>Q3：讲一下为什么用微前端，qiankun的特性是什么，和其他微前端框架对比？</p></blockquote> <p><strong>微前端架构</strong></p> <ul><li>HTML entry</li> <li>沙箱
<ul><li>js 沙箱隔离</li> <li>css 样式隔离</li></ul></li> <li>应用间通信</li> <li>预加载</li></ul> <table><thead><tr><th>微前端框架</th> <th>原理</th> <th>优点</th> <th>不足</th></tr></thead> <tbody><tr><td>qiankun(ali基于single-spa)</td> <td>监听路由变化，渲染对应的子应用，进行挂载</td> <td>1.单一子应用   2.子应用无法保活  3.接入适配成本高</td> <td></td></tr> <tr><td>wujie(tencent)</td> <td></td> <td></td> <td></td></tr> <tr><td>micro-app(jd)</td> <td><strong>WebComponent</strong>、CustomElement、ShadowDom</td> <td></td> <td></td></tr></tbody></table> <p>拓展：<a href="https://eluxjs.com/designed/micro-module.html" target="_blank" rel="noopener noreferrer"><strong>微模块</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>Q4: why? 背景? 优缺点?</p></blockquote> <ul><li>业务上：为了整合公司已有的众多后台管理系统，删减遗弃的系统功能，也为了梳理业务线条，统一化系统管理</li> <li>技术上：为了后续新系统接入，兼容不同技术的系统，同时接触全新的 ts+vue3 技术体系</li></ul> <blockquote><p>Q5: 说说你对monorepo的理解？他的优缺点是什么？</p></blockquote> <p>A：传统的<code>mutirepo</code>是多项目多仓库，而<code>monorepo</code>是多项目单仓库，目前google,vue3,vite 这些知名开源项目都是采用这种方式进行管理。</p> <ul><li>mutirepo的痛点
<ul><li>代码复用：不利于 组件/工具函数/配置 的复用</li> <li>版本管理：同一个依赖，不同项目可能用了不同版本，每个项目都需要手动依次更新</li> <li>项目基建：CICD流程，发布部署，代码提交流程的不统一</li></ul></li></ul> <h2 id="eams、uni-app、小蓝书、官网"><a href="#eams、uni-app、小蓝书、官网" class="header-anchor">#</a> eams、uni-app、小蓝书、官网</h2> <p><code>Vue3 + Ts + Vite + Pinia + echarts + Tailwindcss</code></p> <h3 id="_1-制定代码和git规范-standard-规范-、自动化版本管理"><a href="#_1-制定代码和git规范-standard-规范-、自动化版本管理" class="header-anchor">#</a> 1. 制定代码和git规范(<code>standard</code> 规范)、自动化版本管理</h3> <ul><li><p>git cz =&gt; Commitlint规范化提交格式 / cz-conventional-changelog(changelog生成)</p></li> <li><p>standard-version =&gt; 根据提交信息，更新版本号，打tag</p></li> <li><p>代码规范(eslint检测 + vscode 插件自动格式化)</p> <ul><li>js: <code>Eslint</code></li> <li>html: <code>plugin:vue/vue3-essential</code>/<code>plugin:vue/recommended</code>、<code>@vue/standard</code></li> <li>ts: <code>@vue/typescript/recommended</code></li> <li>scss: stylelint <code>stylelint-config-standard-scss</code></li></ul></li> <li><p>git规范：格式化提交，自动化更新版本号及生成changelog</p> <ul><li>Husky(pre-commit/commit-msg/pre-push) + Lint-staged</li> <li>Commitlint(git cz) + cz-conventional-changelog</li> <li>standard-version：更新版本</li></ul></li></ul> <h3 id="_2-echarts封装"><a href="#_2-echarts封装" class="header-anchor">#</a> 2. <strong>echarts封装</strong></h3> <h3 id="_3-pinia-持久化存储-pinia-plugin-persistedstate"><a href="#_3-pinia-持久化存储-pinia-plugin-persistedstate" class="header-anchor">#</a> 3. pinia + 持久化存储(<code>pinia-plugin-persistedstate</code>)</h3> <h3 id="_4-首屏加载优化"><a href="#_4-首屏加载优化" class="header-anchor">#</a> 4. 首屏加载优化</h3> <ul><li>ngnix 开启gzip压缩</li> <li>前端 <code>compression-webpack-plugin</code> 插件压缩js和css</li></ul> <h3 id="_5-html2canvas-pdfjs"><a href="#_5-html2canvas-pdfjs" class="header-anchor">#</a> 5. html2canvas pdfjs</h3> <ul><li>图片如何适配pdf大小</li> <li><strong>页眉页码</strong></li> <li>清晰度问题：设置缩放比例，设置设备像素比</li> <li><strong>！！分页处理</strong> <ul><li>先将长图统一转成canvas</li> <li>然后通过固定的A4纸宽高（减去页眉页码），<code>新创建一个canvas</code>，用于<code>绘制当前页面的canvas</code></li> <li>通过宽高和原始的canvas数据，对新创建的canvas进行数据填充</li> <li>一页页绘制</li></ul></li> <li><strong>！！！截断处理</strong> <ul><li>获取长图的dom，在绘制当页canvas时，判断当前最后一个元素高度是否被截断，截断则将此元素放至下一页</li></ul></li> <li><strong>浏览器会限制最大的canvas高度(chrome: 16384px)</strong></li></ul> <h3 id="_6-多请求下loading-的展示和关闭"><a href="#_6-多请求下loading-的展示和关闭" class="header-anchor">#</a> 6. 多请求下loading 的展示和关闭</h3> <ul><li>通过全局的 app.vue 中全局的 loading配合 axios 拦截器实现（<code>axios 中需要增加一个请求计数器</code>=&gt; 统计所有发出的请求数，每完成一个减一，当且仅当计数为0的时候才关闭loading）</li></ul> <h3 id="_7-批量导出"><a href="#_7-批量导出" class="header-anchor">#</a> 7. 批量导出</h3> <ul><li>服务端导出实现逻辑
<ol><li>客户端导入报表(excel)，node 接口读取关键字段</li> <li>node 端通过 <code>puppeteer</code> 创建浏览器，访问线上小蓝书页面，<code>通过点击事件触发导出</code>。</li> <li>客户端配合将pdf上传至 <code>oss</code> 服务器，生成线上链接，插入到页面中的节点属性中。</li> <li>node 通过获取浏览器节点的属性，得到pdf链接</li></ol></li> <li>批量
<ul><li>promise 实现任务队列，控制并发数</li></ul></li></ul> <h3 id="项目总结-3"><a href="#项目总结-3" class="header-anchor">#</a> 项目总结</h3> <h4 id="难点"><a href="#难点" class="header-anchor">#</a> 难点</h4> <blockquote><p>pdfjs 导出 4、50页 的报告</p></blockquote> <ul><li><p>中文字体</p></li> <li><p>清晰度问题</p></li> <li><p>可否复制问题</p></li> <li><p><strong>如何分页，何时截断</strong></p> <ul><li><p>把 dom 细分到每个3级目录</p></li> <li><p>图片打印分类</p> <ul><li>可复制的表（addTable 会自动换行）</li> <li>不可绘制的表（用图片打印，判断最后一个td 进行截断）</li> <li>echart 分类（直接打印，单页装不下就换行）</li></ul></li> <li><p>打印方法</p> <ul><li>创建2个 canvas(1个装dom，另一个装截断的 dom)</li></ul></li></ul></li></ul> <h4 id="可优化"><a href="#可优化" class="header-anchor">#</a> 可优化</h4> <h4 id="设计思路-3"><a href="#设计思路-3" class="header-anchor">#</a> 设计思路</h4> <h4 id="运作流程-3"><a href="#运作流程-3" class="header-anchor">#</a> 运作流程</h4> <h4 id="项目背景"><a href="#项目背景" class="header-anchor">#</a> 项目背景</h4></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-record/2.项目/cms.html" class="prev">
        cms
      </a></span> <span class="next"><a href="/study-record/2.项目/jssdk-monitor.html">
        jssdk-monitor
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-record/assets/js/app.17aac99d.js" defer></script><script src="/study-record/assets/js/2.016b014c.js" defer></script><script src="/study-record/assets/js/1.4d9187d3.js" defer></script><script src="/study-record/assets/js/60.e7406693.js" defer></script>
  </body>
</html>
